{
  "title": "PipelineStructureDesc",
  "description": "Outlines the internal structure of a [Pipeline][kiara.pipeline.pipeline.Pipeline].",
  "type": "object",
  "properties": {
    "pipeline_id": {
      "title": "Pipeline Id",
      "description": "The (unique) pipeline id.",
      "type": "string"
    },
    "steps": {
      "title": "Steps",
      "description": "The steps contained in this pipeline, with the 'step_id' as key.",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/StepDesc"
      }
    },
    "processing_stages": {
      "title": "Processing Stages",
      "description": "The order in which this pipeline has to be processed (basically the dependencies of each step on other steps, if any).",
      "type": "array",
      "items": {
        "type": "array",
        "items": {
          "type": "string"
        }
      }
    },
    "pipeline_input_connections": {
      "title": "Pipeline Input Connections",
      "description": "The connections of this pipelines input fields. One input field can be connected to one or several step input fields.",
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": {
          "type": "string"
        }
      }
    },
    "pipeline_output_connections": {
      "title": "Pipeline Output Connections",
      "description": "The connections of this pipelines output fields. Each pipeline output is connected to exactly one step output field.",
      "type": "object",
      "additionalProperties": {
        "type": "string"
      }
    }
  },
  "required": [
    "pipeline_id",
    "steps",
    "processing_stages",
    "pipeline_input_connections",
    "pipeline_output_connections"
  ],
  "additionalProperties": false,
  "definitions": {
    "StepValueAddress": {
      "title": "StepValueAddress",
      "description": "Small model to describe the address of a value of a step, within a Pipeline/PipelineStructure.",
      "type": "object",
      "properties": {
        "step_id": {
          "title": "Step Id",
          "description": "The id of a step within a pipeline.",
          "type": "string"
        },
        "value_name": {
          "title": "Value Name",
          "description": "The name of the value (output name or pipeline input name).",
          "type": "string"
        },
        "sub_value": {
          "title": "Sub Value",
          "description": "A reference to a subitem of a value (e.g. column, list item)",
          "type": "string"
        }
      },
      "required": [
        "step_id",
        "value_name"
      ],
      "additionalProperties": false
    },
    "PipelineStep": {
      "title": "PipelineStep",
      "description": "A step within a pipeline-structure, includes information about it's connection(s) and other metadata.",
      "type": "object",
      "properties": {
        "step_id": {
          "title": "Step Id",
          "type": "string"
        },
        "parent_id": {
          "title": "Parent Id",
          "type": "string"
        },
        "module_type": {
          "title": "Module Type",
          "description": "The module type.",
          "type": "string"
        },
        "module_config": {
          "title": "Module Config",
          "description": "The module config.",
          "type": "object"
        },
        "processing_stage": {
          "title": "Processing Stage",
          "description": "The stage number this step is executed within the pipeline.",
          "type": "integer"
        },
        "input_links": {
          "title": "Input Links",
          "description": "The links that connect to inputs of the module.",
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/StepValueAddress"
            }
          }
        }
      },
      "required": [
        "step_id",
        "parent_id",
        "module_type"
      ],
      "additionalProperties": false
    },
    "StepDesc": {
      "title": "StepDesc",
      "description": "Details of a single [PipelineStep][kiara.pipeline.structure.PipelineStep] (which lives within a [Pipeline][kiara.pipeline.pipeline.Pipeline]",
      "type": "object",
      "properties": {
        "step": {
          "title": "Step",
          "description": "Attributes of the step itself.",
          "allOf": [
            {
              "$ref": "#/definitions/PipelineStep"
            }
          ]
        },
        "processing_stage": {
          "title": "Processing Stage",
          "description": "The processing stage of this step within a Pipeline.",
          "type": "integer"
        },
        "input_connections": {
          "title": "Input Connections",
          "description": "A map that explains what elements connect to this steps inputs. A connection could either be a Pipeline input (indicated by the '__pipeline__' token), or another steps output.",
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "output_connections": {
          "title": "Output Connections",
          "description": "A map that explains what elemnts connect to this steps outputs. A connection could be either a Pipeline output, or another steps input.",
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "required": [
        "step",
        "processing_stage",
        "input_connections",
        "output_connections"
      ],
      "additionalProperties": false
    }
  }
}